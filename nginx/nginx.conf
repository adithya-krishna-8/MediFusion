# # events {
# #     worker_connections 1024;
# # }

# # http {
# #     server {
# #         listen 80;

# #         # 1. API Requests -> Backend
# #         location /api {
# #             proxy_pass http://backend:8000;
# #             proxy_set_header Host $host;
# #             proxy_set_header X-Real-IP $remote_addr;
# #         }

# #         # 2. Swagger Docs -> Backend
# #         location /docs {
# #             proxy_pass http://backend:8000/docs;
# #             proxy_set_header Host $host;
# #         }
# #         location /openapi.json {
# #             proxy_pass http://backend:8000/openapi.json;
# #             proxy_set_header Host $host;
# #         }

# #         # 3. Everything Else -> Frontend (React)
# #         location / {
# #             try_files $uri $uri/ /index.html;
# #             proxy_pass http://frontend:3000;
# #             proxy_set_header Host $host;
# #             proxy_set_header X-Real-IP $remote_addr;
# #             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# #             proxy_set_header X-Forwarded-Proto $scheme;
# #             proxy_http_version 1.1;
# #             proxy_set_header Upgrade $http_upgrade;
# #             proxy_set_header Connection "upgrade";
# #         }
# #     }
# # }
# #------------------------------------------------
# # events {}

# # http {
# #   upstream frontend {
# #     server frontend:3000;
# #   }

# #   upstream backend {
# #     server backend:8000;
# #   }

# #   server {
# #     listen 80;
# #     server_name _;

# #     # Proxy all API calls to FastAPI
# #     location /api/ {
# #       proxy_pass http://backend;
# #       proxy_set_header Host $host;
# #       proxy_set_header X-Real-IP $remote_addr;
# #       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# #       proxy_set_header X-Forwarded-Proto $scheme;
# #     }

# #     # React SPA: send every other route to the frontend dev server
# #     location / {
# #       proxy_pass http://frontend;
# #       proxy_http_version 1.1;
# #       proxy_set_header Upgrade $http_upgrade;
# #       proxy_set_header Connection "upgrade";
# #       proxy_set_header Host $host;
# #       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# #       proxy_set_header X-Forwarded-Proto $scheme;
# #     }
# #   }
# # }
# server {
#   listen 80;
#   server_name _;

#   upstream frontend {
#     server frontend:3000;
#   }

#   upstream backend {
#     server backend:8000;
#   }

#   # API → FastAPI
#   location /api/ {
#     proxy_pass http://backend;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#   }

#   # React SPA routes → frontend dev server
#   location / {
#     proxy_pass http://frontend;
#     proxy_http_version 1.1;
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection "upgrade";
#     proxy_set_header Host $host;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#   }
# }

#--------------------------------

# This file is loaded inside the default nginx.conf's http{} via conf.d/*.conf
server {
  listen 80;
  server_name _;

  # Proxy API to FastAPI container directly
  location /api/ {
    proxy_pass http://backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
    # FastAPI docs & schema
    # FastAPI docs & schema (preserve exact path)
    # FastAPI docs & schema — force to backend
  location ^~ /docs {
    proxy_pass http://backend:8000/docs;
    proxy_set_header Host $host;
  }
  location ^~ /redoc {
    proxy_pass http://backend:8000/redoc;
    proxy_set_header Host $host;
  }
  location = /openapi.json {
    proxy_pass http://backend:8000/openapi.json;
    proxy_set_header Host $host;
  }



  # All other routes -> React dev server
  location / {
    proxy_pass http://frontend:3000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
